<h2 mat-dialog-title color="primary">
  {{isEditing ? 'Editar Boleta' : 'Regitrar Boleta'}}
</h2>

<mat-dialog-content>
  <form [formGroup]="boletaForm">
    <div class="row">

      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>file_copy</mat-icon>
          <mat-label>Tipo de boleta</mat-label>
          <mat-select formControlName="tipo_boleta_id">
            <mat-option *ngFor="let tipo_boleta of tipo_boleta" [value]="tipo_boleta.id">
              {{tipo_boleta.nombre}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="col-lg-6 col-md-6 col-sm-12">

        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>receipt</mat-icon>
          <mat-label>Número</mat-label>
          <input matInput formControlName="numero" required>
          <mat-error *ngIf="boletaForm.get('numero')?.invalid">Este campo es requerido</mat-error>
        </mat-form-field>
      </div>

      <mat-form-field appearance="fill" class="w-100">
        <mat-icon matIconPrefix>chat_bubble</mat-icon>
        <mat-label>Concepto</mat-label>
        <textarea matInput formControlName="concepto" required rows="1"></textarea>
        <mat-error *ngIf="boletaForm.get('concepto')?.invalid">Este campo es requerido</mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="w-100">
        <mat-icon matIconPrefix>store</mat-icon>
        <mat-label>Proyecto</mat-label>
        <mat-select formControlName="proyecto_id" required>
          <mat-option>
            <input matInput placeholder="Buscar..." [formControl]="proyectoFilterCtrl"
              (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()" />
          </mat-option>

          <mat-option *ngFor="let proyecto of filteredProyectos" [value]="proyecto.id">
            {{ proyecto.nombre }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="boletaForm.get('proyecto_id')?.invalid">
          Este campo es requerido
        </mat-error>
      </mat-form-field>


      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>assessment</mat-icon>
          <mat-label>Estado</mat-label>
          <mat-select formControlName="estado_id" required>
            <mat-option *ngFor="let estado of estados" [value]="estado.id">
              {{estado.nombre}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="boletaForm.get('estado_id')?.invalid">Este campo es requerido</mat-error>
        </mat-form-field>

      </div>
      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>business</mat-icon>
          <mat-label>Entidad Financiera</mat-label>
          <mat-select formControlName="entidad_financiera_id">
            <mat-option *ngFor="let entidad of entidadesFinancieras" [value]="entidad.id">
              {{entidad.nombre}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Fecha Inicio</mat-label>
          <input matInput [matDatepicker]="picker1" formControlName="fecha_inicio" required>
          <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
          <mat-error *ngIf="boletaForm.get('fecha_inicio')?.invalid">Este campo es requerido</mat-error>
        </mat-form-field>
      </div>
      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Fecha Finalización</mat-label>
          <input matInput [matDatepicker]="picker2" formControlName="fecha_finalizacion" required>
          <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
          <mat-error *ngIf="boletaForm.get('fecha_finalizacion')?.invalid">Este campo es requerido</mat-error>
        </mat-form-field>
      </div>

      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>monetization_on</mat-icon>
          <mat-label>Monto</mat-label>
          <input matInput type="number" formControlName="monto" required min="0" step="0.01">
          <mat-error *ngIf="boletaForm.get('monto')?.invalid">Ingrese un monto válido</mat-error>
        </mat-form-field>
      </div>
      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>push_pin</mat-icon>
          <mat-label>CITE</mat-label>
          <input matInput formControlName="cite">
        </mat-form-field>
      </div>

      <mat-form-field appearance="fill" class="w-100">
        <mat-icon matIconPrefix>description</mat-icon>
        <mat-label>Observaciones</mat-label>
        <input matInput formControlName="observaciones">
      </mat-form-field>
      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>list_alt</mat-icon>
          <mat-label>Nota de Ejecución</mat-label>
          <input matInput formControlName="nota_ejecucion">
        </mat-form-field>
      </div>
      <div class="col-lg-6 col-md-6 col-sm-12">
        <mat-form-field appearance="fill" class="w-100">
          <mat-icon matIconPrefix>note_add</mat-icon>
          <mat-label>Archivo PDF</mat-label>
          <input type="text" matInput [value]="archivoNombre" placeholder="Selecciona un archivo PDF" readonly
            (click)="fileInput.click()">
          <button mat-icon-button matSuffix (click)="fileInput.click()" type="button">
            <mat-icon>attach_file</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
  </form>
</mat-dialog-content>

<input #fileInput type="file" style="display: none" accept=".pdf" (change)="onFileSelected($event)">
<mat-dialog-actions align="end">
  <button mat-raised-button mat-dialog-close> <mat-icon>close</mat-icon>Cancelar</button>
  <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="boletaForm.invalid">
    <mat-icon>
      @if (isEditing) {save} @else {add_box}
    </mat-icon>
    {{isEditing ? 'Actualizar' : 'Crear'}}
  </button>
</mat-dialog-actions>